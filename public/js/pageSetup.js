'use strict';

//Classes that can be applied to change div colors
var colArr = ["bg-success", "bg-info", "bg-danger", "bg-warning", "bg-primary"];

var numOuterDivs = 72;
var numInnerDivsPerOuter = 6;

function extractColorIndex(elem){
	for (var i=0; i<colArr.length; i++)
		if (elem.hasClass(colArr[i]))
			return i;
	return -1;
}

function cycleColors(elem){
	var $elem = $(elem);
	var oldIndex = extractColorIndex($elem);
	if (oldIndex > -1)
		$elem.removeClass(colArr[oldIndex]);
	$elem.addClass(colArr[(oldIndex+1) % colArr.length]);
}

function formatId(i, j) {
	return "" + i + "_" + j;
}

function createInnerDiv(i, j) {
	var id = formatId(i,j);
	var attrs = {
		"class" : "col-lg-2 col-md-4 col-sm-6 col-xs-12 clickable inner-div",
		"onclick" : "cycleColors(this);",
		"id" : id
	};
	var out = $('<div></div>', attrs);
	return out;
}

function createOuterDiv(i){
	var attrs = {
		"class" : "col-md-2 col-sm-3 col-xs-2 col-lg-2"
	};
	var out = $('<div></div>', attrs);
	var row = $('<div class="row"></div>');
	out.append(row);

	for (var j=0; j<numInnerDivsPerOuter; j++)
		row.append(createInnerDiv(i, j));
	
	return out;
}

//Returns a description of the current color layout
function getPattern(){
	var out = [];
	for (var i=0; i<colArr.length; i++){
		out[i] = [];
	}
	$('.inner-div').each(function(i, e){
		var $e = $(e);
		var colInd = extractColorIndex($e);
		if (colInd > -1)
			out[colInd].push($e.attr('id'));
	});
	return out;
}

function applyPattern(pattern){
	removeAllColors();
	var $divs = $('.inner-div');

	for (var colInd=0; colInd<pattern.length; colInd++){
		var color = colArr[colInd];
		var divs = pattern[colInd];
		for (var i=0; i<divs.length; i++){
			$('#'+divs[i]).addClass(color);
		}
	}
}

//logs a text representation of the pattern
function formatPattern(pattern){
	var out = '[\n';
	for (var i=0; i<colArr.length; i++){
		var arr = pattern[i];
		out += '\t['
		for (var j=0; j<arr.length; j++){
			out += '"'+arr[j] + '"'
			if (j < arr.length-1)
				out += ', '
		}
		if (i < colArr.length - 1)
			out += '],\n';
		else
			out += ']\n'
	}
	out += ']';
	console.log(out);
}

function updateDivClass(shouldAdd, className){
	if (shouldAdd)
		$('.inner-div').addClass(className);
	else
		$('.inner-div').removeClass(className);
}

function removeAllColors(){
	colArr.forEach(function(bg){
		updateDivClass(false, bg);
	});
}

//Gets the contents of the textbox
function getKey(){
	return $('#txtKey').val();
}

$(document).ready(function(){
	var $row = $("<div class='row'></div>");
	$row.appendTo('#mainContainer')

	for (var i=0; i<numOuterDivs; i++){
		createOuterDiv(i).appendTo($row);
	}

	$('#btnBlankOut').click(function(){
		removeAllColors();
	});

	$('#chkGridLines').change(function(){ 
		updateDivClass(this.checked, 'outline');
	});

	$('#chkDivNumbers').change(function(){
		updateDivClass(this.checked, 'show-text');
	});

	$('#chkAmpColors').change(function(){
		updateDivClass(this.checked, 'override-theme');
	});

	$('#btnStore').click(function(){
		var pattern = getPattern();
		patternMap[getKey()] = pattern;
		formatPattern(pattern);
	});

	$('#btnRetrieve').click(function(){
		var key = getKey();
		if (key in patternMap)
			applyPattern(patternMap[key]);
		else
			console.log('No pattern "'+key+'" found');
	});

	// Initialize state to Hello World
	$('#txtKey').val("hello");
	$('#btnRetrieve').click();
});

var patternMap = {

	'hello' : [
		["0_5", "1_0", "1_1", "1_2", "1_3", "1_4", "2_0", "2_1", "2_2", "2_5", "3_0", "3_1", "3_2", "3_5", "4_0", "4_1", "4_2", "4_3", "4_4", "5_5", "6_0", "6_1", "6_3", "6_4", "6_5", "8_1", "8_3", "8_4", "8_5", "9_0", "9_1", "9_3", "9_4", "9_5", "11_1", "11_2", "11_3", "11_4", "11_5", "12_0", "13_1", "13_3", "13_4", "13_5", "14_1", "14_3", "14_4", "14_5", "15_1", "15_3", "15_4", "15_5", "16_1", "16_3", "16_4", "16_5", "18_3", "18_4", "18_5", "19_1", "19_4", "19_5", "20_0", "20_1", "20_4", "20_5", "21_0", "21_1", "21_4", "21_5", "22_0", "22_1", "22_4", "22_5", "23_3", "23_4", "23_5", "24_0", "24_1", "25_1", "25_4", "25_5", "26_0", "26_1", "26_4", "26_5", "27_0", "27_1", "27_4", "27_5", "28_0", "28_1", "28_3", "29_1", "29_2", "29_3", "29_4", "29_5", "32_3", "32_4", "32_5", "33_0", "33_4", "33_5", "34_1", "34_3", "35_1", "35_2", "35_3", "35_4", "35_5", "36_1", "37_1", "38_1", "38_3", "38_4", "38_5", "39_0", "39_1", "39_3", "39_4", "39_5", "40_1", "40_3", "40_4", "40_5", "41_1", "41_2", "41_3", "41_4", "41_5", "43_1", "43_3", "43_4", "43_5", "44_0", "44_1", "44_3", "44_4", "44_5", "45_0", "45_1", "45_3", "45_4", "45_5", "46_0", "46_1", "46_3", "46_4", "46_5", "47_1", "47_2", "47_3", "47_4", "47_5", "48_3", "49_3", "49_5", "50_0", "50_3", "50_5", "51_0", "51_3", "51_5", "52_0", "52_3", "52_4", "53_1", "53_2", "53_3", "53_4", "53_5", "55_1", "55_3", "55_4", "55_5", "56_0", "56_1", "56_3", "56_4", "56_5", "57_0", "57_1", "57_3", "57_4", "57_5", "59_1", "59_4", "59_5", "60_3", "60_4", "60_5", "64_1", "65_1", "65_2", "65_4", "65_5", "66_0", "66_1", "66_2", "66_3", "66_4", "66_5", "67_0", "67_1", "67_2", "67_3", "67_4", "67_5", "68_0", "68_1", "68_2", "68_3", "68_4", "68_5", "69_0", "69_1", "69_2", "69_3", "69_4", "69_5", "70_0", "70_1", "70_2", "70_3", "70_4", "70_5", "71_0", "71_1", "71_3", "71_4", "71_5"],
		["6_2", "7_0", "7_2", "7_3", "7_4", "7_5", "8_0", "8_2", "9_2", "10_2", "10_3", "10_4", "10_5", "11_0", "12_2", "13_2", "14_2", "15_2", "16_2", "17_0", "18_2", "19_0", "19_2", "20_2", "21_2", "22_2", "23_0", "24_2", "25_0", "25_2", "26_2", "27_2", "28_2", "29_0", "30_4", "30_5", "31_0", "31_2", "31_3", "31_4", "31_5", "32_0", "32_2", "34_2", "35_0", "36_2", "36_3", "36_4", "37_0", "37_2", "37_3", "37_4", "37_5", "38_0", "38_2", "39_2", "40_2", "41_0", "42_2", "43_0", "43_2", "44_2", "45_2", "46_2", "47_0", "48_2", "49_0", "49_2", "50_2", "51_2", "52_2", "53_0", "54_2", "55_0", "55_2", "56_2", "57_2", "58_2", "59_0", "59_2", "59_3", "60_2", "61_0", "61_2", "61_3", "61_4", "61_5", "62_0", "62_2", "62_3", "62_4", "62_5", "63_0", "63_2", "63_3", "63_4", "63_5", "64_2", "64_3", "64_4", "64_5", "65_0", "65_3", "71_2"],
		["0_0", "0_1", "0_2", "0_3", "0_4", "1_5", "2_3", "2_4", "3_3", "3_4", "4_5", "5_0", "5_1", "5_2", "5_3", "5_4", "7_1", "10_0", "10_1", "12_1", "12_3", "12_4", "12_5", "13_0", "14_0", "15_0", "16_0", "17_1", "17_2", "17_3", "17_4", "17_5", "18_0", "18_1", "19_3", "20_3", "21_3", "22_3", "23_1", "23_2", "24_3", "24_4", "24_5", "25_3", "26_3", "27_3", "28_4", "28_5", "30_0", "30_1", "30_2", "30_3", "31_1", "32_1", "33_1", "33_2", "33_3", "34_0", "34_4", "34_5", "36_0", "36_5", "40_0", "42_0", "42_1", "42_3", "42_4", "42_5", "48_0", "48_1", "48_4", "48_5", "49_1", "49_4", "50_1", "50_4", "51_1", "51_4", "52_1", "52_5", "54_0", "54_1", "54_3", "54_4", "54_5", "58_0", "58_1", "58_3", "58_4", "58_5", "60_0", "60_1", "61_1", "62_1", "63_1", "64_0"],
		[],
		[]
	],

	'5color' : [
		["0_0", "0_1", "0_2", "0_3", "0_4", "0_5", "5_0", "5_1", "5_2", "5_3", "5_4", "5_5", "10_0", "10_1", "10_2", "10_3", "10_4", "10_5", "15_0", "15_1", "15_2", "15_3", "15_4", "15_5", "20_0", "20_1", "20_2", "20_3", "20_4", "20_5", "25_0", "25_1", "25_2", "25_3", "25_4", "25_5", "30_0", "30_1", "30_2", "30_3", "30_4", "30_5", "35_0", "35_1", "35_2", "35_3", "35_4", "35_5", "40_0", "40_1", "40_2", "40_3", "40_4", "40_5", "45_0", "45_1", "45_2", "45_3", "45_4", "45_5", "50_0", "50_1", "50_2", "50_3", "50_4", "50_5", "55_0", "55_1", "55_2", "55_3", "55_4", "55_5", "60_0", "60_1", "60_2", "60_3", "60_4", "60_5", "65_0", "65_1", "65_2", "65_3", "65_4", "65_5", "70_0", "70_1", "70_2", "70_3", "70_4", "70_5"],
		["1_0", "1_1", "1_2", "1_3", "1_4", "1_5", "6_0", "6_1", "6_2", "6_3", "6_4", "6_5", "11_0", "11_1", "11_2", "11_3", "11_4", "11_5", "16_0", "16_1", "16_2", "16_3", "16_4", "16_5", "21_0", "21_1", "21_2", "21_3", "21_4", "21_5", "26_0", "26_1", "26_2", "26_3", "26_4", "26_5", "31_0", "31_1", "31_2", "31_3", "31_4", "31_5", "36_0", "36_1", "36_2", "36_3", "36_4", "36_5", "41_0", "41_1", "41_2", "41_3", "41_4", "41_5", "46_0", "46_1", "46_2", "46_3", "46_4", "46_5", "51_0", "51_1", "51_2", "51_3", "51_4", "51_5", "56_0", "56_1", "56_2", "56_3", "56_4", "56_5", "61_0", "61_1", "61_2", "61_3", "61_4", "61_5", "66_0", "66_1", "66_2", "66_3", "66_4", "66_5", "71_0", "71_1", "71_2", "71_3", "71_4", "71_5"],
		["2_0", "2_1", "2_2", "2_3", "2_4", "2_5", "7_0", "7_1", "7_2", "7_3", "7_4", "7_5", "12_0", "12_1", "12_2", "12_3", "12_4", "12_5", "17_0", "17_1", "17_2", "17_3", "17_4", "17_5", "22_0", "22_1", "22_2", "22_3", "22_4", "22_5", "27_0", "27_1", "27_2", "27_3", "27_4", "27_5", "32_0", "32_1", "32_2", "32_3", "32_4", "32_5", "37_0", "37_1", "37_2", "37_3", "37_4", "37_5", "42_0", "42_1", "42_2", "42_3", "42_4", "42_5", "47_0", "47_1", "47_2", "47_3", "47_4", "47_5", "52_0", "52_1", "52_2", "52_3", "52_4", "52_5", "57_0", "57_1", "57_2", "57_3", "57_4", "57_5", "62_0", "62_1", "62_2", "62_3", "62_4", "62_5", "67_0", "67_1", "67_2", "67_3", "67_4", "67_5"],
		["3_0", "3_1", "3_2", "3_3", "3_4", "3_5", "8_0", "8_1", "8_2", "8_3", "8_4", "8_5", "13_0", "13_1", "13_2", "13_3", "13_4", "13_5", "18_0", "18_1", "18_2", "18_3", "18_4", "18_5", "23_0", "23_1", "23_2", "23_3", "23_4", "23_5", "28_0", "28_1", "28_2", "28_3", "28_4", "28_5", "33_0", "33_1", "33_2", "33_3", "33_4", "33_5", "38_0", "38_1", "38_2", "38_3", "38_4", "38_5", "43_0", "43_1", "43_2", "43_3", "43_4", "43_5", "48_0", "48_1", "48_2", "48_3", "48_4", "48_5", "53_0", "53_1", "53_2", "53_3", "53_4", "53_5", "58_0", "58_1", "58_2", "58_3", "58_4", "58_5", "63_0", "63_1", "63_2", "63_3", "63_4", "63_5", "68_0", "68_1", "68_2", "68_3", "68_4", "68_5"],
		["4_0", "4_1", "4_2", "4_3", "4_4", "4_5", "9_0", "9_1", "9_2", "9_3", "9_4", "9_5", "14_0", "14_1", "14_2", "14_3", "14_4", "14_5", "19_0", "19_1", "19_2", "19_3", "19_4", "19_5", "24_0", "24_1", "24_2", "24_3", "24_4", "24_5", "29_0", "29_1", "29_2", "29_3", "29_4", "29_5", "34_0", "34_1", "34_2", "34_3", "34_4", "34_5", "39_0", "39_1", "39_2", "39_3", "39_4", "39_5", "44_0", "44_1", "44_2", "44_3", "44_4", "44_5", "49_0", "49_1", "49_2", "49_3", "49_4", "49_5", "54_0", "54_1", "54_2", "54_3", "54_4", "54_5", "59_0", "59_1", "59_2", "59_3", "59_4", "59_5", "64_0", "64_1", "64_2", "64_3", "64_4", "64_5", "69_0", "69_1", "69_2", "69_3", "69_4", "69_5"]
	]
};